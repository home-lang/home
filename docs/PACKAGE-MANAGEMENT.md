# Ion Package Management

Ion comes with a built-in package manager that makes it easy to manage dependencies from multiple sources: registries, GitHub repositories, and direct URLs.

## Table of Contents

- [Quick Start](#quick-start)
- [Package Sources](#package-sources)
- [CLI Commands](#cli-commands)
- [Configuration File](#configuration-file)
- [Lock File](#lock-file)
- [Examples](#examples)

## Quick Start

Initialize a new Ion project:

```bash
ion pkg init
```

This creates an `ion.toml` file with default configuration:

```toml
[package]
name = "my-ion-project"
version = "0.1.0"
authors = []

[dependencies]
# Add your dependencies here
```

Add a dependency:

```bash
# From registry
ion pkg add http-router@1.0.0

# From GitHub (shortcut)
ion pkg add ion-lang/zyte

# From full Git URL
ion pkg add https://github.com/user/package.git

# From direct URL
ion pkg add https://example.com/package.tar.gz
```

Install all dependencies:

```bash
ion pkg install
```

## Package Sources

### Registry Packages

Install packages from the official Ion package registry:

```bash
ion pkg add http-router@1.0.0
```

In `ion.toml`:

```toml
[dependencies]
http-router = "1.0.0"
```

### GitHub Packages

Use GitHub shortcuts for easy access:

```bash
# Automatically expands to https://github.com/ion-lang/zyte.git
ion pkg add ion-lang/zyte
```

In `ion.toml`:

```toml
[dependencies]
zyte = { git = "https://github.com/ion-lang/zyte" }
```

Specify a specific branch, tag, or commit:

```bash
ion pkg add ion-lang/zyte@v1.0.0
```

```toml
[dependencies]
zyte = { git = "https://github.com/ion-lang/zyte", rev = "v1.0.0" }
```

### URL-Based Packages

Install from any HTTP/HTTPS URL:

```bash
ion pkg add https://example.com/my-package.tar.gz
```

```toml
[dependencies]
my-package = { url = "https://example.com/my-package.tar.gz" }
```

### Local Packages

Use local packages during development:

```toml
[dependencies]
my-local-lib = { path = "../my-local-lib" }
```

## CLI Commands

### `ion pkg init`

Initialize a new Ion project with an `ion.toml` file.

```bash
ion pkg init
```

### `ion pkg add <package>`

Add a dependency to your project. Supports multiple formats:

```bash
# Registry package with version
ion pkg add package-name@1.2.3

# GitHub shortcut
ion pkg add user/repo

# Full Git URL
ion pkg add https://github.com/user/repo.git

# Direct URL
ion pkg add https://example.com/package.tar.gz
```

### `ion pkg remove <package>`

Remove a dependency from your project:

```bash
ion pkg remove package-name
```

### `ion pkg install`

Install all dependencies listed in `ion.toml`:

```bash
ion pkg install
```

Creates/updates `ion.lock` for reproducible builds.

### `ion pkg update`

Update all dependencies to their latest versions:

```bash
ion pkg update
```

## Configuration File

The `ion.toml` file defines your project and its dependencies.

### Full Example

```toml
[package]
name = "my-awesome-app"
version = "1.0.0"
authors = ["Your Name <you@example.com>"]

[dependencies]
# Registry packages
http-router = "1.0.0"
json-parser = "2.3.1"

# GitHub packages
zyte = { git = "https://github.com/ion-lang/zyte", rev = "main" }
ui-kit = { git = "https://github.com/user/ui-kit", rev = "v2.0.0" }

# URL-based packages
custom-lib = { url = "https://cdn.example.com/libs/custom-1.0.tar.gz" }

# Local packages (for development)
utils = { path = "../shared-utils" }
```

## Lock File

Ion generates an `ion.lock` file to ensure reproducible builds. This file contains:

- Exact versions of all dependencies
- Checksums for integrity verification
- Dependency tree with all transitive dependencies

**Never edit `ion.lock` manually.** It is automatically generated by `ion pkg install` and `ion pkg update`.

### Example `ion.lock`

```toml
# This file is generated by ion pkg
version = 1

[[package]]
name = "http-router"
version = "1.0.0"
checksum = "abc123def456..."

[[package]]
name = "zyte"
version = "main"
checksum = "789ghi012jkl..."
```

## Examples

### Creating a Web Application

```bash
# Initialize project
ion pkg init

# Add web framework dependencies
ion pkg add http-router@1.0.0
ion pkg add ion-lang/zyte

# Install dependencies
ion pkg install
```

Your `ion.toml`:

```toml
[package]
name = "my-web-app"
version = "0.1.0"
authors = []

[dependencies]
http-router = "1.0.0"
zyte = { git = "https://github.com/ion-lang/zyte" }
```

### Using Multiple Sources

```toml
[package]
name = "multi-source-app"
version = "1.0.0"

[dependencies]
# Official registry
http-router = "1.0.0"

# GitHub with specific version
auth-lib = { git = "https://github.com/secure/auth", rev = "v2.1.0" }

# Private Git repository
internal-tools = { git = "https://gitlab.company.com/tools/internal" }

# Direct download
legacy-lib = { url = "https://legacy.example.com/lib-1.0.tar.gz" }

# Local development
my-module = { path = "../my-module" }
```

### Updating Dependencies

```bash
# Update all to latest versions
ion pkg update

# Or update ion.toml manually and reinstall
ion pkg install
```

### Removing Unused Dependencies

```bash
# Remove a specific package
ion pkg remove old-package

# Clean install
rm -rf .ion/cache
ion pkg install
```

## Package Cache

Downloaded packages are cached in `.ion/cache` to speed up subsequent installations.

Cache structure:

```
.ion/
└── cache/
    ├── http-router/
    │   └── 1.0.0/
    ├── zyte/
    │   └── main/
    └── custom-lib/
        └── url-based/
```

### Cleaning the Cache

```bash
rm -rf .ion/cache
ion pkg install
```

## Best Practices

1. **Commit `ion.toml` and `ion.lock`** to version control
2. **Don't commit `.ion/cache`** - add it to `.gitignore`
3. **Use semantic versioning** for your packages
4. **Lock specific versions** in production
5. **Test after updating** dependencies
6. **Document** any custom package sources

## Troubleshooting

### Package not found

```bash
# Make sure you have the correct package name
ion pkg add correct-package-name@1.0.0

# For GitHub packages, verify the repository exists
ion pkg add existing-user/existing-repo
```

### Git clone fails

```bash
# Ensure git is installed
git --version

# Check network connectivity
ping github.com

# Try with full URL instead of shortcut
ion pkg add https://github.com/user/repo.git
```

### Download fails

```bash
# Check if curl or wget is available
curl --version
wget --version

# Verify the URL is accessible
curl -I https://example.com/package.tar.gz
```

## Future Features

- Dependency version resolution algorithms
- Package publishing to official registry
- Private registry support
- Package signing and verification
- Workspace support for monorepos
- Dev dependencies separation

## Contributing

To contribute to Ion's package management system:

1. Check existing issues and discussions
2. Submit bug reports with detailed reproduction steps
3. Propose new features with use cases
4. Contribute code improvements and tests

## Resources

- [Ion Documentation](https://docs.ion-lang.org)
- [Package Registry](https://packages.ion-lang.org)
- [GitHub Repository](https://github.com/ion-lang/ion)
- [Community Discord](https://discord.gg/ion-lang)
