// Comprehensive String and Array Methods Tests
// Tests: string methods, array methods, slices, ranges

// ============================================
// Test 1: Basic string operations
// ============================================
fn test_basic_strings(): i32 {
    let s1 = "Hello";
    let s2 = "World";

    // Concatenation
    let combined = s1 + ", " + s2 + "!";
    if (combined != "Hello, World!") { return 1; }

    // Length
    if (s1.len() != 5) { return 2; }
    if (s2.len() != 5) { return 3; }

    return 0;
}

// ============================================
// Test 2: String methods - case conversion
// ============================================
fn test_string_case(): i32 {
    let s = "Hello World";

    let upper = s.upper();
    if (upper != "HELLO WORLD") { return 1; }

    let lower = s.lower();
    if (lower != "hello world") { return 2; }

    // Mixed case
    let mixed = "HeLLo WoRLD";
    if (mixed.upper() != "HELLO WORLD") { return 3; }
    if (mixed.lower() != "hello world") { return 4; }

    return 0;
}

// ============================================
// Test 3: String methods - trimming
// ============================================
fn test_string_trim(): i32 {
    let s = "  hello world  ";

    let trimmed = s.trim();
    if (trimmed != "hello world") { return 1; }

    let left_trimmed = s.trim_start();
    if (left_trimmed != "hello world  ") { return 2; }

    let right_trimmed = s.trim_end();
    if (right_trimmed != "  hello world") { return 3; }

    return 0;
}

// ============================================
// Test 4: String methods - searching
// ============================================
fn test_string_search(): i32 {
    let s = "hello world hello";

    // Contains
    if (s.contains("world") != true) { return 1; }
    if (s.contains("xyz") != false) { return 2; }

    // Starts with
    if (s.starts_with("hello") != true) { return 3; }
    if (s.starts_with("world") != false) { return 4; }

    // Ends with
    if (s.ends_with("hello") != true) { return 5; }
    if (s.ends_with("world") != false) { return 6; }

    // Index of
    let idx = s.index_of("world");
    if (idx != 6) { return 7; }

    return 0;
}

// ============================================
// Test 5: String methods - split and join
// ============================================
fn test_string_split_join(): i32 {
    let s = "apple,banana,cherry";

    let parts = s.split(",");
    if (parts[0] != "apple") { return 1; }
    if (parts[1] != "banana") { return 2; }
    if (parts[2] != "cherry") { return 3; }

    // Join
    let words = ["one", "two", "three"];
    let joined = words.join("-");
    if (joined != "one-two-three") { return 4; }

    return 0;
}

// ============================================
// Test 6: String methods - replace
// ============================================
fn test_string_replace(): i32 {
    let s = "hello world";

    let replaced = s.replace("world", "there");
    if (replaced != "hello there") { return 1; }

    let s2 = "aaa";
    let replaced2 = s2.replace("a", "b");
    if (replaced2 != "bbb") { return 2; }

    return 0;
}

// ============================================
// Test 7: String methods - substring and slicing
// ============================================
fn test_string_slice(): i32 {
    let s = "hello world";

    // Substring
    let sub = s.substring(0, 5);
    if (sub != "hello") { return 1; }

    let sub2 = s.substring(6, 11);
    if (sub2 != "world") { return 2; }

    // Character at index
    let ch = s.char_at(0);
    if (ch != "h") { return 3; }

    let ch2 = s.char_at(6);
    if (ch2 != "w") { return 4; }

    return 0;
}

// ============================================
// Test 8: String methods - repeat and reverse
// ============================================
fn test_string_repeat_reverse(): i32 {
    let s = "ab";

    let repeated = s.repeat(3);
    if (repeated != "ababab") { return 1; }

    let s2 = "hello";
    let reversed = s2.reverse();
    if (reversed != "olleh") { return 2; }

    return 0;
}

// ============================================
// Test 9: Array operations - creation and access
// ============================================
fn test_array_basic(): i32 {
    let arr = [1, 2, 3, 4, 5];

    if (arr[0] != 1) { return 1; }
    if (arr[4] != 5) { return 2; }
    if (arr.len() != 5) { return 3; }

    // Empty array
    let empty: [i32] = [];
    if (empty.len() != 0) { return 4; }

    return 0;
}

// ============================================
// Test 10: Array methods - push and pop
// ============================================
fn test_array_push_pop(): i32 {
    let mut arr = [1, 2, 3];

    arr.push(4);
    if (arr.len() != 4) { return 1; }
    if (arr[3] != 4) { return 2; }

    let popped = arr.pop();
    if (popped != 4) { return 3; }
    if (arr.len() != 3) { return 4; }

    return 0;
}

// ============================================
// Test 11: Array methods - map and filter
// ============================================
fn double(x: i32): i32 { return x * 2; }
fn is_even(x: i32): bool { return x % 2 == 0; }

fn test_array_map_filter(): i32 {
    let arr = [1, 2, 3, 4, 5];

    // Map
    let doubled = arr.map(double);
    if (doubled[0] != 2) { return 1; }
    if (doubled[2] != 6) { return 2; }
    if (doubled[4] != 10) { return 3; }

    // Filter
    let evens = arr.filter(is_even);
    if (evens.len() != 2) { return 4; }
    if (evens[0] != 2) { return 5; }
    if (evens[1] != 4) { return 6; }

    return 0;
}

// ============================================
// Test 12: Array methods - reduce and fold
// ============================================
fn add(a: i32, b: i32): i32 { return a + b; }
fn multiply(a: i32, b: i32): i32 { return a * b; }

fn test_array_reduce(): i32 {
    let arr = [1, 2, 3, 4, 5];

    // Reduce (sum)
    let sum = arr.reduce(add, 0);
    if (sum != 15) { return 1; }

    // Reduce (product)
    let product = arr.reduce(multiply, 1);
    if (product != 120) { return 2; }

    return 0;
}

// ============================================
// Test 13: Array methods - find and contains
// ============================================
fn greater_than_3(x: i32): bool { return x > 3; }

fn test_array_find(): i32 {
    let arr = [1, 2, 3, 4, 5];

    // Find
    let found = arr.find(greater_than_3);
    if (found != 4) { return 1; }

    // Contains
    if (arr.contains(3) != true) { return 2; }
    if (arr.contains(10) != false) { return 3; }

    // Index of
    let idx = arr.index_of(3);
    if (idx != 2) { return 4; }

    return 0;
}

// ============================================
// Test 14: Array methods - sort and reverse
// ============================================
fn test_array_sort_reverse(): i32 {
    let mut arr = [3, 1, 4, 1, 5, 9, 2, 6];

    // Sort
    arr.sort();
    if (arr[0] != 1) { return 1; }
    if (arr[1] != 1) { return 2; }
    if (arr[7] != 9) { return 3; }

    // Reverse
    let arr2 = [1, 2, 3];
    let reversed = arr2.reverse();
    if (reversed[0] != 3) { return 4; }
    if (reversed[2] != 1) { return 5; }

    return 0;
}

// ============================================
// Test 15: Array slicing
// ============================================
fn test_array_slice(): i32 {
    let arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];

    // Slice from start to end
    let slice1 = arr[2..5];
    if (slice1[0] != 2) { return 1; }
    if (slice1[2] != 4) { return 2; }
    if (slice1.len() != 3) { return 3; }

    // Slice from start
    let slice2 = arr[..3];
    if (slice2[0] != 0) { return 4; }
    if (slice2[2] != 2) { return 5; }

    // Slice to end
    let slice3 = arr[7..];
    if (slice3[0] != 7) { return 6; }
    if (slice3[2] != 9) { return 7; }

    return 0;
}

// ============================================
// Test 16: Range operations
// ============================================
fn test_ranges(): i32 {
    // Exclusive range
    let range1 = 0..5;
    if (range1.len() != 5) { return 1; }
    if (range1.contains(5) != false) { return 2; }
    if (range1.contains(4) != true) { return 3; }

    // Inclusive range
    let range2 = 0..=5;
    if (range2.len() != 6) { return 4; }
    if (range2.contains(5) != true) { return 5; }

    // Range with step
    let range3 = (0..10).step(2);
    // 0, 2, 4, 6, 8
    if (range3.len() != 5) { return 6; }

    return 0;
}

// ============================================
// Test 17: Array concatenation and flattening
// ============================================
fn test_array_concat(): i32 {
    let arr1 = [1, 2, 3];
    let arr2 = [4, 5, 6];

    let combined = arr1.concat(arr2);
    if (combined.len() != 6) { return 1; }
    if (combined[0] != 1) { return 2; }
    if (combined[5] != 6) { return 3; }

    // Using spread
    let combined2 = [...arr1, ...arr2];
    if (combined2.len() != 6) { return 4; }

    return 0;
}

// ============================================
// Test 18: Array any/all/none
// ============================================
fn is_positive(x: i32): bool { return x > 0; }
fn is_negative(x: i32): bool { return x < 0; }

fn test_array_predicates(): i32 {
    let positive = [1, 2, 3, 4, 5];
    let mixed = [-1, 0, 1, 2, 3];
    let negative = [-1, -2, -3];

    // Any
    if (positive.any(is_positive) != true) { return 1; }
    if (negative.any(is_positive) != false) { return 2; }

    // All
    if (positive.all(is_positive) != true) { return 3; }
    if (mixed.all(is_positive) != false) { return 4; }

    // None
    if (positive.none(is_negative) != true) { return 5; }
    if (mixed.none(is_negative) != false) { return 6; }

    return 0;
}

// ============================================
// Main test runner
// ============================================
fn main(): i32 {
    let t1 = test_basic_strings();
    if (t1 != 0) { print("test_basic_strings failed\n"); return 1; }

    let t2 = test_string_case();
    if (t2 != 0) { print("test_string_case failed\n"); return 2; }

    let t3 = test_string_trim();
    if (t3 != 0) { print("test_string_trim failed\n"); return 3; }

    let t4 = test_string_search();
    if (t4 != 0) { print("test_string_search failed\n"); return 4; }

    let t5 = test_string_split_join();
    if (t5 != 0) { print("test_string_split_join failed\n"); return 5; }

    let t6 = test_string_replace();
    if (t6 != 0) { print("test_string_replace failed\n"); return 6; }

    let t7 = test_string_slice();
    if (t7 != 0) { print("test_string_slice failed\n"); return 7; }

    let t8 = test_string_repeat_reverse();
    if (t8 != 0) { print("test_string_repeat_reverse failed\n"); return 8; }

    let t9 = test_array_basic();
    if (t9 != 0) { print("test_array_basic failed\n"); return 9; }

    let t10 = test_array_push_pop();
    if (t10 != 0) { print("test_array_push_pop failed\n"); return 10; }

    let t11 = test_array_map_filter();
    if (t11 != 0) { print("test_array_map_filter failed\n"); return 11; }

    let t12 = test_array_reduce();
    if (t12 != 0) { print("test_array_reduce failed\n"); return 12; }

    let t13 = test_array_find();
    if (t13 != 0) { print("test_array_find failed\n"); return 13; }

    let t14 = test_array_sort_reverse();
    if (t14 != 0) { print("test_array_sort_reverse failed\n"); return 14; }

    let t15 = test_array_slice();
    if (t15 != 0) { print("test_array_slice failed\n"); return 15; }

    let t16 = test_ranges();
    if (t16 != 0) { print("test_ranges failed\n"); return 16; }

    let t17 = test_array_concat();
    if (t17 != 0) { print("test_array_concat failed\n"); return 17; }

    let t18 = test_array_predicates();
    if (t18 != 0) { print("test_array_predicates failed\n"); return 18; }

    print("All string and array tests passed!\n");
    return 0;
}
