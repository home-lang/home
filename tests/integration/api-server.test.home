// Integration Test: Simple Data Operations

// ============================================================================
// USER DATA HANDLING
// ============================================================================

it("should create and validate user data") {
    let name = "Alice";
    let email = "alice@example.com";
    let age = 30;

    // Validate name
    assert(name.len() > 0);

    // Validate email contains @
    assert(email.contains("@"));

    // Validate age range
    assert(age >= 0);
    assert(age <= 150);
}

it("should detect invalid email") {
    let email = "invalid-email";
    let is_valid = email.contains("@");
    assert(is_valid == false);
}

it("should detect empty name") {
    let name = "";
    assert(name.len() == 0);
}

// ============================================================================
// DATA ARRAY OPERATIONS
// ============================================================================

it("should store users in array") {
    let users = [
        { "name": "Alice", "age": 30 },
        { "name": "Bob", "age": 25 },
        { "name": "Charlie", "age": 35 },
    ];

    assert(users.len() == 3);
}

it("should access user by index") {
    let users = ["Alice", "Bob", "Charlie"];

    assert(users[0] == "Alice");
    assert(users[1] == "Bob");
    assert(users[2] == "Charlie");
}

it("should iterate through users") {
    let names = ["Alice", "Bob", "Charlie"];
    let mut count = 0;

    for (name in names) {
        count = count + 1;
    }

    assert(count == 3);
}

// ============================================================================
// STRING PROCESSING
// ============================================================================

it("should format user information") {
    let name = "Alice";
    let formatted = "User: " + name + ", Age: 30";

    assert(formatted.contains("Alice"));
    assert(formatted.contains("30"));
}

it("should parse and validate input") {
    let input = "  john@example.com  ";
    let cleaned = input.trim();

    assert(cleaned == "john@example.com");
    assert(cleaned.contains("@"));
}

it("should extract domain from email") {
    let email = "user@example.com";
    let parts = email.split("@");

    assert(parts.len() == 2);
    assert(parts[0] == "user");
    assert(parts[1] == "example.com");
}

// ============================================================================
// DATA TRANSFORMATION
// ============================================================================

it("should normalize usernames") {
    let usernames = ["ALICE", "Bob", "charlie"];
    let normalized = [];

    for (name in usernames) {
        normalized = normalized.push(name.lower());
    }

    assert(normalized[0] == "alice");
    assert(normalized[1] == "bob");
    assert(normalized[2] == "charlie");
}

it("should filter by condition") {
    let ages = [15, 25, 30, 12, 45];
    let adults = [];

    for (age in ages) {
        if (age >= 18) {
            adults = adults.push(age);
        }
    }

    assert(adults.len() == 3);  // 25, 30, 45
}

// ============================================================================
// NUMERIC OPERATIONS
// ============================================================================

it("should calculate average age") {
    let ages = [20, 30, 40, 50];
    let mut sum = 0;

    for (age in ages) {
        sum = sum + age;
    }

    let avg = sum / ages.len();
    assert(avg == 35);
}

it("should find min and max") {
    let ages = [25, 18, 42, 33, 21];

    let mut min = ages[0];
    let mut max = ages[0];

    for (age in ages) {
        if (age < min) {
            min = age;
        }
        if (age > max) {
            max = age;
        }
    }

    assert(min == 18);
    assert(max == 42);
}

// ============================================================================
// CONDITIONAL LOGIC
// ============================================================================

it("should apply business rules") {
    let age = 25;
    let has_id = true;

    // Check if user can purchase alcohol
    let can_purchase = age >= 21 and has_id;
    assert(can_purchase == true);
}

it("should determine user tier") {
    let points = 1500;

    let tier = if (points >= 2000) {
        "platinum"
    } else if (points >= 1000) {
        "gold"
    } else if (points >= 500) {
        "silver"
    } else {
        "bronze"
    };

    assert(tier == "gold");
}

// ============================================================================
// DATA VALIDATION WORKFLOW
// ============================================================================

it("should validate complete registration") {
    let name = "Alice Johnson";
    let email = "alice@example.com";
    let password = "secure123";
    let age = 28;

    // All validations must pass
    let name_valid = name.len() >= 2;
    let email_valid = email.contains("@");
    let password_valid = password.len() >= 8;
    let age_valid = age >= 13;

    let all_valid = name_valid and email_valid and password_valid and age_valid;
    assert(all_valid == true);
}

it("should collect validation errors") {
    let name = "";
    let email = "invalid";
    let password = "short";
    let age = 10;

    let errors = [];

    if (name.len() < 2) {
        errors = errors.push("Name too short");
    }
    if (!email.contains("@")) {
        errors = errors.push("Invalid email");
    }
    if (password.len() < 8) {
        errors = errors.push("Password too short");
    }
    if (age < 13) {
        errors = errors.push("Must be at least 13");
    }

    assert(errors.len() == 4);
}
