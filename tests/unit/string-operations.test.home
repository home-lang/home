// String Operations Unit Tests

// ============================================================================
// STRING CREATION
// ============================================================================

it("should create empty string") {
    let s = "";
    assert(s.len() == 0);
    assert(s == "");
}

it("should create string from literal") {
    let s = "hello";
    assert(s == "hello");
    assert(s.len() == 5);
}

it("should create multiline string") {
    let s = "line1
line2
line3";
    assert(s.contains("line1"));
    assert(s.contains("line2"));
}

// ============================================================================
// STRING CONCATENATION
// ============================================================================

it("should concatenate strings") {
    let a = "hello";
    let b = "world";
    let c = a + " " + b;
    assert(c == "hello world");
}

it("should concatenate empty strings") {
    let a = "";
    let b = "test";
    assert((a + b) == "test");
    assert((b + a) == "test");
    assert((a + a) == "");
}

it("should concatenate multiple strings") {
    let result = "a" + "b" + "c" + "d" + "e";
    assert(result == "abcde");
}

// ============================================================================
// STRING INDEXING
// ============================================================================

it("should index single character") {
    let s = "hello";
    assert(s[0] == 'h');
    assert(s[1] == 'e');
    assert(s[4] == 'o');
}

it("should index last characters") {
    let s = "hello";
    let len = s.len();
    // Access from end using length calculation
    assert(s[len - 1] == 'o');
    assert(s[len - 2] == 'l');
    assert(s[len - 5] == 'h');
}

// ============================================================================
// STRING SLICING
// ============================================================================

it("should slice from start") {
    let s = "hello world";
    assert(s[0..5] == "hello");
}

it("should slice to end") {
    let s = "hello world";
    assert(s[6..11] == "world");
}

it("should slice middle") {
    let s = "hello world";
    assert(s[3..8] == "lo wo");
}

// ============================================================================
// STRING COMPARISON
// ============================================================================

it("should compare equal strings") {
    assert("hello" == "hello");
    assert("" == "");
}

it("should compare unequal strings") {
    assert("hello" != "world");
    assert("hello" != "Hello");
    assert("hello" != "hello ");
}

it("should compare strings by content") {
    // Use string comparison via equality
    assert("apple" != "banana");
    assert("abc" != "abd");
    assert("aa" != "aaa");
    assert("same" == "same");
}

// ============================================================================
// CASE CONVERSION
// ============================================================================

it("should convert to uppercase") {
    assert("hello".upper() == "HELLO");
    assert("Hello World".upper() == "HELLO WORLD");
    assert("HELLO".upper() == "HELLO");
    assert("123abc".upper() == "123ABC");
}

it("should convert to lowercase") {
    assert("HELLO".lower() == "hello");
    assert("Hello World".lower() == "hello world");
    assert("hello".lower() == "hello");
    assert("123ABC".lower() == "123abc");
}

// ============================================================================
// WHITESPACE HANDLING
// ============================================================================

it("should trim both sides") {
    assert("  hello  ".trim() == "hello");
    assert("hello".trim() == "hello");
}

it("should trim left") {
    assert("  hello".trim_start() == "hello");
    assert("hello  ".trim_start() == "hello  ");
}

it("should trim right") {
    assert("hello  ".trim_end() == "hello");
    assert("  hello".trim_end() == "  hello");
}

// ============================================================================
// SEARCH OPERATIONS
// ============================================================================

it("should check contains") {
    let s = "hello world";
    assert(s.contains("world") == true);
    assert(s.contains("hello") == true);
    assert(s.contains("xyz") == false);
}

it("should check starts_with") {
    let s = "hello world";
    assert(s.starts_with("hello") == true);
    assert(s.starts_with("world") == false);
    assert(s.starts_with("") == true);
}

it("should check ends_with") {
    let s = "hello world";
    assert(s.ends_with("world") == true);
    assert(s.ends_with("hello") == false);
    assert(s.ends_with("") == true);
}

// ============================================================================
// CHECKING OPERATIONS
// ============================================================================

it("should check if empty") {
    assert("".is_empty() == true);
    assert(" ".is_empty() == false);
    assert("hello".is_empty() == false);
}

// ============================================================================
// REPETITION
// ============================================================================

it("should repeat string") {
    assert("ab".repeat(3) == "ababab");
    assert("x".repeat(5) == "xxxxx");
    assert("hello".repeat(0) == "");
    assert("hello".repeat(1) == "hello");
}

// ============================================================================
// SPLITTING AND REPLACING
// ============================================================================

it("should split string") {
    let s = "a,b,c";
    let parts = s.split(",");
    assert(parts.len() == 3);
    assert(parts[0] == "a");
    assert(parts[1] == "b");
    assert(parts[2] == "c");
}

it("should split by space") {
    let s = "hello world test";
    let words = s.split(" ");
    assert(words.len() == 3);
    assert(words[0] == "hello");
}

it("should replace substring") {
    assert("hello world".replace("world", "rust") == "hello rust");
    assert("aaa".replace("a", "b") == "bbb");
    assert("hello".replace("x", "y") == "hello");
}

// ============================================================================
// CHAR_AT
// ============================================================================

it("should get char_at") {
    let s = "hello";
    assert(s.char_at(0) == "h");
    assert(s.char_at(4) == "o");
}

// ============================================================================
// REVERSE
// ============================================================================

it("should reverse string") {
    assert("hello".reverse() == "olleh");
    assert("abc".reverse() == "cba");
    assert("".reverse() == "");
    assert("a".reverse() == "a");
}

// ============================================================================
// ESCAPE SEQUENCES
// ============================================================================

it("should handle newline escape") {
    let s = "line1\nline2";
    assert(s.contains("\n"));
    assert(s.split("\n").len() == 2);
}

it("should handle tab escape") {
    let s = "col1\tcol2";
    assert(s.contains("\t"));
}

// ============================================================================
// CHAINING
// ============================================================================

it("should chain multiple operations") {
    let s = "  HELLO WORLD  ";
    let result = s.trim().lower().replace("world", "rust");
    assert(result == "hello rust");
}

it("should chain with conditionals") {
    let input = "  Test  ";
    let clean = input.trim();
    let result = if (clean.len() > 0) { clean.lower() } else { "empty" };
    assert(result == "test");
}
