// HTML Parsing and Manipulation Test Suite
// Tests HTML concepts using basic Home syntax

// ============================================================================
// TAG DETECTION
// ============================================================================

it("should detect opening tag") {
    let tag = "<p>";
    assert(tag.starts_with("<"));
    assert(tag.ends_with(">"));
    assert(!tag.contains("/"));
}

it("should detect closing tag") {
    let tag = "</p>";
    assert(tag.starts_with("</"));
    assert(tag.ends_with(">"));
}

it("should detect self-closing tag") {
    let tag = "<br/>";
    assert(tag.starts_with("<"));
    assert(tag.ends_with("/>"));
}

// ============================================================================
// TAG NAME EXTRACTION
// ============================================================================

it("should identify tag names") {
    let tags = ["p", "div", "span", "a", "ul", "li"];
    assert(tags.contains("p"));
    assert(tags.contains("div"));
    assert(tags.len() == 6);
}

it("should normalize tag names to lowercase") {
    let tag = "DIV";
    let normalized = tag.lower();
    assert(normalized == "div");
}

// ============================================================================
// ATTRIBUTE PARSING
// ============================================================================

it("should detect attribute presence") {
    let attr_string = "href=\"https://example.com\"";
    assert(attr_string.contains("href"));
    assert(attr_string.contains("="));
}

it("should detect id attribute") {
    let html = "<div id=\"main\">";
    assert(html.contains("id="));
    assert(html.contains("main"));
}

it("should detect class attribute") {
    let html = "<div class=\"container\">";
    assert(html.contains("class="));
    assert(html.contains("container"));
}

it("should detect multiple classes") {
    let classes = "foo bar baz";
    let class_list = classes.split(" ");
    assert(class_list.len() == 3);
    assert(class_list.contains("foo"));
    assert(class_list.contains("bar"));
    assert(class_list.contains("baz"));
}

it("should detect data attributes") {
    let html = "<div data-value=\"42\">";
    assert(html.contains("data-"));
    assert(html.contains("42"));
}

// ============================================================================
// TEXT CONTENT
// ============================================================================

it("should extract text between tags") {
    let content = "Hello World";
    assert(content == "Hello World");
    assert(content.len() == 11);
}

it("should handle empty content") {
    let content = "";
    assert(content.len() == 0);
}

it("should trim whitespace from content") {
    let content = "  Hello  ";
    let trimmed = content.trim();
    assert(trimmed == "Hello");
}

// ============================================================================
// SELECTOR PATTERNS
// ============================================================================

it("should recognize id selector") {
    let selector = "#main";
    assert(selector.starts_with("#"));
}

it("should recognize class selector") {
    let selector = ".container";
    assert(selector.starts_with("."));
}

it("should recognize tag selector") {
    let selector = "div";
    assert(!selector.starts_with("#"));
    assert(!selector.starts_with("."));
}

it("should recognize attribute selector") {
    let selector = "[href]";
    assert(selector.starts_with("["));
    assert(selector.ends_with("]"));
}

it("should recognize descendant selector") {
    let selector = "div p";
    assert(selector.contains(" "));
}

it("should recognize child selector") {
    let selector = "div > p";
    assert(selector.contains(">"));
}

it("should recognize sibling selector") {
    let selector = "p + p";
    assert(selector.contains("+"));
}

// ============================================================================
// DOM TREE STRUCTURE
// ============================================================================

it("should track parent-child relationships") {
    let parent = "div";
    let children = ["p", "span", "a"];
    assert(children.len() == 3);
    assert(children.contains("p"));
}

it("should track sibling order") {
    let siblings = ["first", "second", "third"];
    assert(siblings.first() == "first");
    assert(siblings.last() == "third");
}

it("should get child count") {
    let children = ["li", "li", "li"];
    assert(children.len() == 3);
}

it("should check if element has children") {
    let children = ["p"];
    assert(!children.is_empty());

    let empty_children = [1];
    let remaining = empty_children.pop();
    assert(remaining.is_empty());
}

// ============================================================================
// HTML ENTITY ENCODING
// ============================================================================

it("should identify less than entity") {
    let entity = "&lt;";
    let decoded = "<";
    assert(entity.contains("lt"));
    assert(decoded == "<");
}

it("should identify greater than entity") {
    let entity = "&gt;";
    let decoded = ">";
    assert(entity.contains("gt"));
    assert(decoded == ">");
}

it("should identify ampersand entity") {
    let entity = "&amp;";
    let decoded = "&";
    assert(entity.contains("amp"));
}

it("should identify quote entity") {
    let entity = "&quot;";
    assert(entity.contains("quot"));
}

it("should identify apostrophe entity") {
    let entity = "&#39;";
    assert(entity.contains("39"));
}

// ============================================================================
// HTML SANITIZATION PATTERNS
// ============================================================================

it("should detect script tags") {
    let html = "<script>alert('xss')</script>";
    let is_dangerous = html.contains("<script");
    assert(is_dangerous == true);
}

it("should detect onclick handlers") {
    let html = "<p onclick=\"evil()\">Text</p>";
    let is_dangerous = html.contains("onclick");
    assert(is_dangerous == true);
}

it("should detect event handlers") {
    let dangerous_attrs = ["onclick", "onload", "onerror", "onmouseover"];
    assert(dangerous_attrs.contains("onclick"));
    assert(dangerous_attrs.contains("onload"));
}

it("should identify safe tags") {
    let safe_tags = ["p", "div", "span", "b", "i", "strong", "em"];
    assert(safe_tags.contains("p"));
    assert(safe_tags.contains("strong"));
    assert(!safe_tags.contains("script"));
}

it("should identify safe attributes") {
    let safe_attrs = ["href", "src", "class", "id", "alt", "title"];
    assert(safe_attrs.contains("href"));
    assert(safe_attrs.contains("class"));
    assert(!safe_attrs.contains("onclick"));
}

// ============================================================================
// CSS CLASS MANIPULATION
// ============================================================================

it("should add class to list") {
    let mut classes = ["existing"];
    classes = classes.push("new");
    assert(classes.contains("existing"));
    assert(classes.contains("new"));
}

it("should check if class exists") {
    let classes = ["foo", "bar", "baz"];
    assert(classes.contains("foo"));
    assert(!classes.contains("nonexistent"));
}

it("should track class toggle state") {
    let mut has_class = true;
    has_class = !has_class;
    assert(has_class == false);
    has_class = !has_class;
    assert(has_class == true);
}

// ============================================================================
// VOID ELEMENTS
// ============================================================================

it("should identify void elements") {
    let void_elements = ["br", "hr", "img", "input", "meta", "link"];
    assert(void_elements.contains("br"));
    assert(void_elements.contains("img"));
    assert(!void_elements.contains("div"));
}

it("should check if tag is void") {
    let tag = "br";
    let void_elements = ["br", "hr", "img", "input"];
    let is_void = void_elements.contains(tag);
    assert(is_void == true);
}

// ============================================================================
// BLOCK VS INLINE ELEMENTS
// ============================================================================

it("should identify block elements") {
    let block_elements = ["div", "p", "h1", "ul", "ol", "li", "table"];
    assert(block_elements.contains("div"));
    assert(block_elements.contains("p"));
}

it("should identify inline elements") {
    let inline_elements = ["span", "a", "strong", "em", "b", "i"];
    assert(inline_elements.contains("span"));
    assert(inline_elements.contains("a"));
}

// ============================================================================
// HTML VALIDATION PATTERNS
// ============================================================================

it("should detect unclosed tags") {
    let open_tags = ["div", "p", "span"];
    let close_tags = ["div", "span"];
    let is_balanced = open_tags.len() == close_tags.len();
    assert(is_balanced == false);
}

it("should detect balanced tags") {
    let open_count = 3;
    let close_count = 3;
    assert(open_count == close_count);
}

// ============================================================================
// INNER VS OUTER HTML
// ============================================================================

it("should distinguish inner content") {
    let outer = "<div><p>Hello</p></div>";
    let inner = "<p>Hello</p>";
    assert(outer.contains(inner));
    assert(outer.len() > inner.len());
}

it("should include wrapper in outer") {
    let outer = "<p>Hello</p>";
    assert(outer.starts_with("<p>"));
    assert(outer.ends_with("</p>"));
}

// ============================================================================
// PRETTY PRINTING
// ============================================================================

it("should detect newlines for pretty print") {
    let pretty = "<div>\n  <p>Hello</p>\n</div>";
    assert(pretty.contains("\n"));
}

it("should detect indentation") {
    let indented = "  <p>Hello</p>";
    assert(indented.starts_with("  "));
}

// ============================================================================
// URL HANDLING IN ATTRIBUTES
// ============================================================================

it("should detect absolute URLs") {
    let url = "https://example.com";
    assert(url.starts_with("https://"));
}

it("should detect relative URLs") {
    let url = "/path/to/page";
    assert(url.starts_with("/"));
    assert(!url.contains("://"));
}

it("should detect protocol-relative URLs") {
    let url = "//example.com/path";
    assert(url.starts_with("//"));
}

// ============================================================================
// SPECIAL CHARACTERS
// ============================================================================

it("should handle quotes in attributes") {
    let double_quote = "\"";
    let single_quote = "'";
    assert(double_quote.len() == 1);
    assert(single_quote.len() == 1);
}

it("should escape special characters in content") {
    let special_chars = ["<", ">", "&", "\"", "'"];
    assert(special_chars.len() == 5);
    assert(special_chars.contains("<"));
    assert(special_chars.contains("&"));
}
