// Markdown Parsing Concept Test Suite
// Tests markdown patterns and structure using basic Home syntax

// ============================================================================
// HEADING PATTERNS
// ============================================================================

it("should detect h1 with single hash") {
    let line = "# Heading 1";
    assert(line.starts_with("# "));
}

it("should detect h2 with double hash") {
    let line = "## Heading 2";
    assert(line.starts_with("## "));
}

it("should detect h3 through h6") {
    let h3 = "### Heading";
    let h4 = "#### Heading";
    let h5 = "##### Heading";
    let h6 = "###### Heading";

    assert(h3.starts_with("### "));
    assert(h4.starts_with("#### "));
    assert(h5.starts_with("##### "));
    assert(h6.starts_with("###### "));
}

it("should count hash symbols for heading level") {
    let h1 = "# Title";
    let h2 = "## Subtitle";
    let h3 = "### Section";

    // Check prefix patterns
    assert(h1.starts_with("# "));
    assert(h2.starts_with("## "));
    assert(h3.starts_with("### "));
}

// ============================================================================
// EMPHASIS PATTERNS
// ============================================================================

it("should detect bold with double asterisks") {
    let text = "This is **bold** text";
    assert(text.contains("**"));
}

it("should detect bold with double underscores") {
    let text = "This is __bold__ text";
    assert(text.contains("__"));
}

it("should detect italic with single asterisk") {
    let text = "This is *italic* text";
    assert(text.contains("*"));
}

it("should detect italic with single underscore") {
    let text = "This is _italic_ text";
    assert(text.contains("_"));
}

it("should detect strikethrough with double tildes") {
    let text = "This is ~~deleted~~ text";
    assert(text.contains("~~"));
}

// ============================================================================
// LINK PATTERNS
// ============================================================================

it("should detect inline link pattern") {
    let link = "[Link text](https://example.com)";
    assert(link.starts_with("["));
    assert(link.contains("]("));
    assert(link.ends_with(")"));
}

it("should extract link text") {
    let link = "[Click here](https://example.com)";
    // Link text is between [ and ]
    assert(link.contains("Click here"));
}

it("should detect URL in link") {
    let link = "[Link](https://example.com)";
    assert(link.contains("https://"));
}

it("should detect autolink pattern") {
    let autolink = "<https://example.com>";
    assert(autolink.starts_with("<"));
    assert(autolink.ends_with(">"));
    assert(autolink.contains("https://"));
}

it("should detect email link pattern") {
    let email = "<user@example.com>";
    assert(email.starts_with("<"));
    assert(email.ends_with(">"));
    assert(email.contains("@"));
}

// ============================================================================
// IMAGE PATTERNS
// ============================================================================

it("should detect image pattern") {
    let image = "![Alt text](image.png)";
    assert(image.starts_with("!["));
    assert(image.contains("]("));
    assert(image.ends_with(")"));
}

it("should differentiate image from link") {
    let image = "![Alt](img.png)";
    let link = "[Text](url)";

    assert(image.starts_with("!"));
    let link_starts_with_bang = link.starts_with("!");
    assert(link_starts_with_bang == false);
}

// ============================================================================
// LIST PATTERNS
// ============================================================================

it("should detect unordered list with dash") {
    let item = "- List item";
    assert(item.starts_with("- "));
}

it("should detect unordered list with asterisk") {
    let item = "* List item";
    assert(item.starts_with("* "));
}

it("should detect unordered list with plus") {
    let item = "+ List item";
    assert(item.starts_with("+ "));
}

it("should detect ordered list pattern") {
    let item = "1. First item";
    assert(item.contains(". "));
}

it("should detect task list unchecked") {
    let task = "- [ ] Todo item";
    assert(task.contains("[ ]"));
}

it("should detect task list checked") {
    let task = "- [x] Done item";
    assert(task.contains("[x]"));
}

// ============================================================================
// CODE PATTERNS
// ============================================================================

it("should detect inline code with backticks") {
    let text = "Use `code` here";
    assert(text.contains("`"));
}

it("should detect fenced code block start") {
    let fence = "```javascript";
    assert(fence.starts_with("```"));
}

it("should detect fenced code block end") {
    let fence = "```";
    assert(fence == "```");
}

it("should extract language from code fence") {
    let fence = "```python";
    assert(fence.starts_with("```"));
    // Language follows the backticks
    let has_language = fence.len() > 3;
    assert(has_language == true);
}

it("should detect indented code block") {
    let code = "    indented code";
    assert(code.starts_with("    "));
}

// ============================================================================
// BLOCKQUOTE PATTERNS
// ============================================================================

it("should detect blockquote") {
    let quote = "> This is a quote";
    assert(quote.starts_with("> "));
}

it("should detect nested blockquote") {
    let nested = ">> Nested quote";
    assert(nested.starts_with(">>"));
}

// ============================================================================
// HORIZONTAL RULE PATTERNS
// ============================================================================

it("should detect horizontal rule with dashes") {
    let hr = "---";
    assert(hr == "---");
}

it("should detect horizontal rule with asterisks") {
    let hr = "***";
    assert(hr == "***");
}

it("should detect horizontal rule with underscores") {
    let hr = "___";
    assert(hr == "___");
}

// ============================================================================
// TABLE PATTERNS
// ============================================================================

it("should detect table row with pipes") {
    let row = "| A | B | C |";
    assert(row.contains("|"));
    assert(row.starts_with("|"));
}

it("should detect table separator row") {
    let separator = "|---|---|---|";
    assert(separator.contains("---"));
    assert(separator.contains("|"));
}

it("should detect left-aligned column") {
    let sep = "|:---|";
    assert(sep.contains(":---"));
}

it("should detect right-aligned column") {
    let sep = "|---:|";
    assert(sep.contains("---:"));
}

it("should detect center-aligned column") {
    let sep = "|:---:|";
    assert(sep.contains(":---:"));
}

// ============================================================================
// LINE BREAK PATTERNS
// ============================================================================

it("should detect hard line break with trailing spaces") {
    let line = "Text with trailing  ";
    assert(line.ends_with("  "));
}

it("should detect paragraph break pattern") {
    let text = "Para 1\n\nPara 2";
    assert(text.contains("\n\n"));
}

// ============================================================================
// ESCAPE PATTERNS
// ============================================================================

it("should detect escaped character") {
    let text = "\\*not italic\\*";
    assert(text.contains("\\*"));
}

it("should recognize escapable characters") {
    let escapable = "\\`*_{}[]()#+-.!";
    assert(escapable.contains("\\"));
    assert(escapable.contains("*"));
    assert(escapable.contains("_"));
}

// ============================================================================
// FRONT MATTER PATTERNS
// ============================================================================

it("should detect YAML front matter delimiter") {
    let delimiter = "---";
    assert(delimiter == "---");
}

it("should detect front matter start") {
    let content = "---\ntitle: Hello\n---\n\n# Content";
    assert(content.starts_with("---"));
}

// ============================================================================
// FOOTNOTE PATTERNS
// ============================================================================

it("should detect footnote reference") {
    let text = "Some text[^1] with footnote";
    assert(text.contains("[^"));
}

it("should detect footnote definition") {
    let footnote = "[^1]: This is the footnote";
    assert(footnote.starts_with("[^"));
    assert(footnote.contains("]: "));
}

// ============================================================================
// DEFINITION LIST PATTERNS
// ============================================================================

it("should detect definition term") {
    let term = "Term";
    let definition = ": Definition";
    assert(definition.starts_with(": "));
}

// ============================================================================
// ABBREVIATION PATTERNS
// ============================================================================

it("should detect abbreviation definition") {
    let abbr = "*[HTML]: Hyper Text Markup Language";
    assert(abbr.starts_with("*["));
    assert(abbr.contains("]: "));
}

// ============================================================================
// HTML IN MARKDOWN
// ============================================================================

it("should detect HTML tag") {
    let html = "<div class=\"note\">";
    assert(html.starts_with("<"));
    assert(html.contains(">"));
}

it("should detect script tag for sanitization") {
    let dangerous = "<script>alert('xss')</script>";
    assert(dangerous.contains("<script>"));
}

// ============================================================================
// URL PATTERNS
// ============================================================================

it("should detect http URL") {
    let url = "http://example.com";
    assert(url.starts_with("http://"));
}

it("should detect https URL") {
    let url = "https://example.com";
    assert(url.starts_with("https://"));
}

it("should detect mailto URL") {
    let url = "mailto:user@example.com";
    assert(url.starts_with("mailto:"));
}

// ============================================================================
// WHITESPACE HANDLING
// ============================================================================

it("should detect leading whitespace") {
    let indented = "    code";
    assert(indented.starts_with(" "));
}

it("should trim whitespace") {
    let text = "  hello  ";
    let trimmed = text.trim();
    assert(trimmed == "hello");
}

// ============================================================================
// NESTED STRUCTURE PATTERNS
// ============================================================================

it("should detect nested list indentation") {
    let nested = "  - Nested item";
    assert(nested.starts_with("  "));
    assert(nested.contains("- "));
}

it("should count indentation level") {
    let level1 = "- Item";
    let level2 = "  - Item";
    let level3 = "    - Item";

    let l1_no_indent = level1.starts_with("- ");
    let l2_indent = level2.starts_with("  ");
    let l3_indent = level3.starts_with("    ");

    assert(l1_no_indent == true);
    assert(l2_indent == true);
    assert(l3_indent == true);
}

// ============================================================================
// REFERENCE LINK PATTERNS
// ============================================================================

it("should detect reference link usage") {
    let ref_link = "[Link text][ref-id]";
    assert(ref_link.contains("]["));
}

it("should detect reference link definition") {
    let ref_def = "[ref-id]: https://example.com";
    assert(ref_def.starts_with("["));
    assert(ref_def.contains("]: "));
}

// ============================================================================
// SPECIAL CHARACTERS
// ============================================================================

it("should handle special markdown characters") {
    let special = ["*", "_", "`", "#", "[", "]", "(", ")", "!", ">", "-", "+"];
    assert(special.len() == 12);
    assert(special.contains("*"));
    assert(special.contains("#"));
}

it("should detect code fence language identifiers") {
    let languages = ["javascript", "python", "rust", "go", "typescript"];
    assert(languages.contains("javascript"));
    assert(languages.contains("python"));
}
